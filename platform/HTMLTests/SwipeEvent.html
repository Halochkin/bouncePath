<!--<script src="../../src/mouse/Swipe.js"></script>-->
<!--<script src="SwipeTest.js"></script>-->


<swipe-element swipe></swipe-element>
<!--<div swipe id="viewport" touch-action="pan-left" pointer-distance="30">-->
<!--    <div id="elem"></div>-->
<!--</div>-->
<!--<button style="float:right" onclick="setTimeout(function(){alert('boo!')}, 2000)">Alert after 2s</button>-->


<script type="module">

  import {FirstConnectedCallbackMixin} from "../../platform/FirstConnectedCallbackMixin.js";
  import {} from "../../platform/CustomElementsMix.js";

  import {mouseDownToSwipeStart} from "../../platform/Events/Swipe.js"

  class customViewPort extends FirstConnectedCallbackMixin(HTMLElement) {
    connectedCallback() {
      if (super.connectedCallback) super.connectedCallback();
    }

    firstConnectedCallback() {
      this.attachShadow({mode: "open"});
      this.shadowRoot.innerHTML = `
        <style>
            #frame {
                position: absolute;
                width: 450px;
                height: 450px;
                background-color: red;
            }

            #viewport {
                display: inline-block;
                width: 450px;
                height: 450px;
                position: relative;
                overflow: hidden;
                background-color: yellow;
                margin: 10px;
                /*margin-top: 20px;*/
                border-radius: 10px;
            }
       </style>
       <div swipe id="viewport" touch-action="pan-left" pointer-distance="30">
         <div id="frame"></div>
       </div>`;
    }

  }

  customElements.mix("swipe-element", [customViewPort, mouseDownToSwipeStart])


</script>


<script type="module">
  import {} from "../../platform/CustomElementsMix.js";
  // <-------------------------- carousel logic ---------------------------------------
function colorPicker() {
  return 'rgb(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(
    Math.random() * 256)) + ')';
}



let swipeStart = 0;
window.addEventListener("swipe-start", e => {
  console.log("swipe-start");
  swipeStart = e.x - e.target.offsetLeft;
});
window.addEventListener("swipe-stop", e => {
  const swipeElement = document.querySelector("swipe-element");
  const viewport = swipeElement.shadowRoot.querySelector("#viewport");
  const frame = swipeElement.shadowRoot.querySelector("#frame");


  console.log("swipe-stop");
  let swipeDist = swipeStart - e.x;
  frame.style.transitionDuration = "0.8s";
  if (Math.abs(swipeDist) < 100) return;
  frame.style.transform = swipeDist > 0 ? "rotate(15deg)" : "rotate(-15deg)";
  frame.style.marginLeft = swipeDist > 0 ? "-650px" : "650px";
  setTimeout(() => {

    viewport.removeChild(frame);
    let el = document.createElement("div");
    el.id = "frame";
    el.transitionDuration = "1s";
    el.style.backgroundColor = colorPicker();
    viewport.appendChild(el);
  }, 500);
});

// <-------------------------- carousel logic ---------------------------------------
</script>